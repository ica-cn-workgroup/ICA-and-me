# 6.Data analysis and monitoring in wastewater systems
To measure is to know but information needs to be properly extracted from the measured data. Measurements are used for decision support, for early warning of disturbances and process changes, for tracking interesting and relevant parameters as well as for the basis of control actions. Measurements from the instrumentation shall be available  24 h a day and 7 days a week. However, even reliable instru- mentation can fail during operation, which can have serious consequences if the instrumentation is used in closed loop control (see 4.1). Therefore real time data validation is needed before using measurements for control purposes. Corrupted measurements must be found and corrected, so that false conclusions based on the measurements are avoided. The components of a plant decision-making system are shown in Fig. 6. To track the current process operational state via the instrumentation is called monitoring.
![Fig. 6]()
Fig. 6 e Decision-making process (from Olsson and Newell, 1999).

We have noted for a long time that these components have traditionally all been implemented by plant-operating personnel using intuition and heuristics developed often subconsciously from their experience. A lot of ICA research has addressed this problem from a systematic point of view. A challenge is to document the experience in the control computer in such a way that the operating personnel may use the information in a consistent way and to save the knowl- edge gained by experienced operators.

## 6.1 Data acquisition
During the 1970s and early 1980s there were hardly any publications in the wastewater profession showing methods for data screening and measurement verification. However, in the control society many methods were well established and were applied in the early computer control installations (Gillblad and Olsson, 1977). An early paper explicitly addressing this issue for wastewater treatment was Kanaya et al. (1985). Almost all measurement series is affected by some problems like missing values, noise or outliers. Then each signal has to be analyzed with respect to its amplitude, mean value, deviation from normal situation, rate of change, trend, and variability.

Wastewater systems are relatively slow systems. Still, when disturbances appear in the plant it may be quite difficult to dampen their effect. Therefore early warning systems are asked for. At the conference ICA (1993) in Hamilton, Canada, it was predicted that this area would gain interest (Olsson, 1993) and over the last few years there has been a significant increase in the interest of detection and isolation of disturbances.

## 6.2 On-line parameter estimation
In Sec. 2.3 we discussed off-line identification as a means to understand the dynamics of a wastewater treatment system. It was also used to detect changes in the process and in sensors. In many cases the investigation of individual signals is insufficient and can not reveal the true state of the process. Variables influence each other and one must often look at several variables simultaneously. On-line instrumentation made it possible to track the performance of a plant and find out key parameters that could indicate the state of the oper- ation, if the plant was in a “normal” operating condition or in some kind of extreme condition. The control actions may be quite different in these cases. The immediate challenge was to find out how models could be identified from the on-line data, and model reduction was a natural ambition.

Using on-line calculation of mass balances for process and sensor verification was well established in chemical process control. Of course this could be used also in wastewater treatment. For example, calculating the MLSS mass balance in the reactor could verify if the MLSS and the return sludge suspended solids measurements were consistent. Estimation of the respiration was discussed in Sec. 2.3. By using the information of the airflow rate and the DO concentration the respiration in the reactor could be estimated. Below we discuss some of the key parameters that could be estimated on-line.

### 6.2.1 Estimation of the clarifier behaviour
The identification experiments for the clarifier dynamics (Olsson and Chapman, 1985) mostly resulted in models of the structure  

 ![eq1]()

where _C<sub>e</sub>_ is the effluent concentration and Q the feed flow rate to the clarifier. We got good indications that the parameters _α<sub>i</sub>_ could be updated recursively:

![eq2]()

The real measurement _C<sub>e</sub>_ is compared with the effluent concentration ![eq3]() predicted by the model. If the predicted value was close to the measurement, then no correction was made. When the difference between measurement and model was significant then the _α_ value had to change. This indicated changing settling behaviour. In the end we were disappointed to find out that this recursive method was not sufficiently reliable to detect settling changes. The quality of the measurements was simply not sufficiently good.


### 6.2.2 Estimating nitrate concentration
The nitrate concentration was estimated in real time by Cecil (2004) based on a dynamic model that is a subset of the ASM1. The DO, ammonium and redox concentrations were measured on-line in the aerated reactors. The model used these measurements to continuously adjust its values for the influent ammonium concentration, the nitrification rate, the denitrification rate and the net hydrolysis. Then it computed the nitrate concentration with an updated value every 10 s. The estimation schemes were used at two full scale activated sludge plants and showed satisfying agreement between the model values and the output of in situ nitrate measurements.

An application of estimating the nitrate concentration in a post-denitrification unit of the Viikinma¨ ki WWTP in Helsinki, Finland is described by Mulas et al. (2011). The control of methanol dosage is usually based on the on-line measurement of the nitrate concentration in the filters. The authors describe the development of an array of soft sensors for real time esti- mation of nitrate concentration. This is used as a back-up software system capable of complementing the existing instrumentation if an instrument failure should happen and provide a more robust control system. Different kinds of multivariate techniques (see 6.3), both linear and nonlinear, were applied with great success, where the estimated accuracy was of the same order as the real nitrate sensor.

### 6.2.3 Using soft sensors for sensor diagnosis
As on-line instrumentation becomes increasingly important for operating modern wastewater treatment plants it is necessary to have diagnostic methods that can indicate sensor deviation at an early stage. At the Rya WWTP (Lumley, 2002) soft sensors have been used to verify instrument read- ings. This includes on-line mass balance calculations, which will present a calculated measurement that can be compared with the real measurement. Another example is the calcula- tion of effluent total P based on effluent turbidity. Still other calculations include estimation of flow rates based on changes in levels.


## 6.3 Monitoring
Multivariate analysis is a way to detect patterns of the oper- ation. Large data sets  of  m  variables  can be  considered  as a data “cloud” in an m-dimensional space. All the measure- ments at one instant make up one point in the cloud. Many of the variables are usually correlated, since most of them reflect some underlying mechanisms that drive the process in different ways. Therefore the true dimension of the cloud is usually much less than m. By  projecting  the  data cloud  on a lower dimension space it is often possible to find key vari- ables. In the simplest case with two variables, a regression line or curve can represent both of them. Multivariate analysis had been used for many years in the chemical process industry, but was introduced into the wastewater industry in the late 1990s (Rosen and Olsson, 1998). Under normal operating conditions the cloud is limited within a certain volume. If some variables are changing the cloud will move outside this volume and an operator can readily detect that something has happened. In principle he will get an automatic detection not only that a single variable has exceeded the permitted amplitude, but the combination of many signals have crossed an alarm limit. Now the analysis allows backtracking the data, so that the real physical signals that caused the deviation can be identified. Each one of the variables may have changed within permitted limits, but the combination of their devia- tions has caused an alarm.

The first challenge is to find a method to project the data into a smaller space. The second one is to find out what is the boundary of a “normal” cloud. In other words, how do we find a suitable method to calculate this boundary. For a single variable we may define one or two sets of alarm limits. For the collection of many signals this “alarm limit” has to be more sophisticated (Rosen, 2001).

The most well-known method to reduce the dimension- ality of the data cloud is Principal Component Analysis (PCA). It is simple in the sense that the data can readily be projected into a small dimension. However, PCA methods are insufficient to deal with data that are highly variable, such as influent flow rates and compositions. Furthermore, the wide range of time constants in a wastewater treatment system makes it difficult to look at correlations of data in just one time scale. Adaptive PCA can handle this kind of challenges, while multiscale PCA decomposes the measurement data into different time scales using wavelet transforms. Having done that a PCA can be used to monitor each time scale. These methods were applied for monitoring wastewater treatment data by Rosen and Lennox (2001) and Lennox and Rosen (2002).

Different operational states can be represented by different locations in the multivariate space. The data points can be identified as being in various clusters with different centre points. Clustering methods can be used to define to what extent the current data point belongs to a predefined class. Here is an obvious application of fuzzy logic when the boundaries between the clusters are uncertain or when some regions are not covered by a class. Fuzzy boundaries also provide a means to seamless transitions between classes (Rosen, 2001).

The multivariate methods have been successful in many applications, but have been much less useful in others. Rosen et al. (2003) provided a description and insight why some of these methods have failed and also gave guidance how to adapt the use of the methods for wastewater treatment operations. Some of the specific challenges in wastewater treatment monitoring have to do with poor data quality and reliability. Nonlinear relationships between variables are also present. The multivariate methods have often been applied as if the system is static. All these challenges have to and can be addressed in order to obtain a successful monitoring. PCA has also been used in sequential batch reactors for monitoring (Villez et al., 2008; Lee and Vanrolleghem, 2003) and as a basis for control of the phase length (Villez et al., 2010).

## 6.4 Knowledge-based systems
In the late 1980s and early 1990s there was a great interest in knowledge-based systems, often called expert systems. They were too often used to replace control algorithms written in mathematical terms and the ambition was also to provide the operator with some advisory system. Several papers on this theme were presented in the 1990 ICA conference. The expectations of the expert systems were often exaggerated and the results did not show any improvement in plant performance compared to conventional feedback controllers. The reason was simply that the performance was limited by the knowledge of the process dynamics and the measure- ments, not by the algorithms. Similar unrealistic expectations of expert systems were also noted in other applications in industrial control. Knowledge-based reasoning systems are instead justified on higher levels of control in plant-wide control systems, discussed in Sec. 11.
